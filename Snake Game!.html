<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="utf-8" />
    <title>Epileptic Snake Game!!!</title>
	<style>
		canvas {
			padding-left: 0;
			padding-right: 0;
			margin-left: auto;
			margin-right: auto;
			display: block;
			height: 100%;
			width: 100%;
            border:1px solid #000;
		}
	</style>
	<script>
		// Map Related
		var m_iMapWidth = 50;
		var m_iMapHeight = 25;
		var m_iTileWidth;
		var m_iTileHeight;
		var m_iBorderLength = 2;
		var m_cBackroundColor = "#000";
		var m_cBorderColor = "#000";

	    // Snake Related
		var m_cSnakeColor = "#000";
		var m_iSnakeStartingLength = 7;
		var m_iSnakeHead = { x: m_iSnakeStartingLength - 2, y: 1 };
		var m_iSnakeBody = new Array(m_iSnakeStartingLength);
		var m_iDirection = "right";

		// Food Related
		var m_cFoodColor = "#000";
		var m_iFoodX = 0;
		var m_iFoodY = 0;
		var m_iAmountAte = 0;
		var m_iPrevAmount = 0;
		var m_iHighestAmount = 0;

	    // Canvas
		var m_CanvasContext;

		// GameSpeed
		var m_iOriginalSpeed = 50;
		var m_iGameSpeed = m_iOriginalSpeed;
		var m_iGameDecrease = 5;
		var m_iGameMinuim = m_iGameDecrease;

		var m_IntervalID;
		document.addEventListener("DOMContentLoaded", initialize, false);
		document.documentElement.style.overflowX = 'hidden';	 // horizontal scrollbar will be hidden
		document.documentElement.style.overflowY = 'hidden';

		function initialize()
		{
			// Initialize gameloop.
			if(m_IntervalID != null)
				clearInterval(m_IntervalID);

			m_IntervalID = window.setInterval("gameLoop();", m_iGameSpeed);
			
			// Get canvas context for drawing
			m_CanvasContext = document.getElementById("myCanvas").getContext("2d");
			setCanvasSize();

            // Get canvas for event listening
			//m_Canvas = document.getElementById("myCanvas");
			window.addEventListener('keydown', doKeyDown, true);

			// Initialize snake
			for (var index = 0; index < m_iSnakeStartingLength; index++)
			    m_iSnakeBody[m_iSnakeStartingLength - index - 1] = {x: index - 1, y: m_iSnakeHead.y};

			setFood();
			drawMap();
			gameLoop();
		}

		// Runs all the functions required for the game to work.
		function gameLoop()
		{
		    setUpSnake();
		    drawMap();

		    // If true, increase snake length, increase gamespeed.
		    if (gotFood())
		    {
		        m_iSnakeBody.push(m_iSnakeBody[m_iSnakeBody.length - 1].x, m_iSnakeBody[m_iSnakeBody.length - 1].y);
		        m_iAmountAte++;
		        setFood();

				if ((m_iGameSpeed - m_iGameDecrease) >= m_iGameMinuim) {
					m_iGameSpeed = m_iGameSpeed - m_iGameDecrease;
					window.clearInterval(m_IntervalID);
					m_IntervalID = window.setInterval("gameLoop()", m_iGameSpeed, false);
				}
			}

			// If true, reset the game.
			if (checkCollision())
			{
			    //alert("You ate " + m_iAmountAte + " !!!");
			    resetGame();
			    initialize();
			}
		}

		// Draws everything on the canvas.
		function drawMap() {

            // Background
		    for (var x = 0; x < m_iMapWidth; x++)
		    {
		        for (var y = 0; y < m_iMapHeight; y++)
		        {
		            if (y == 0)
		                paintTile(x, y, "#FFF", 0);

		            else
		            {
		                // Updates all colors
		                updateColors();
		                // Paints border
		                paintTile(x, y, m_cBorderColor, 0);
		                // Paints inside border
		                paintTile(x, y, m_cBackroundColor, m_iBorderLength);
		            }
		        }
		    }

            // Snake 1
		    for (var index = 0; index < m_iSnakeBody.length; index++)
		    {
		        // Updates all colors
		        updateColors();
		        paintTile(m_iSnakeBody[index].x, m_iSnakeBody[index].y, m_cSnakeColor, m_iBorderLength);
		    }

            // Food
		    paintTile(m_iFoodX, m_iFoodY, m_cFoodColor, m_iBorderLength);

		    // Prints score on top of snake game
		    writeMessage(1, "Score: " + m_iAmountAte);
		    writeMessage(Math.floor((m_iMapWidth/2) - 7), "Previous Score: " + m_iPrevAmount);
		    writeMessage(Math.floor((m_iMapWidth) - 10), "Highest Score: " + m_iHighestAmount);
		}

		// Updates all colors
		function updateColors() {
		    m_cBorderColor = getRandomColor(1, 255);
		    m_cBackroundColor = "#000";;
		    m_cSnakeColor = getRandomColor(1, 255);
		    m_cFoodColor = getRandomColor(1, 255);
		}

		// Handles where the snake should be.
		function setUpSnake()
		{
		    var tempSnakeData;
		    m_iSnakeBody.pop();

		    if (m_iDirection == "right") 
		        tempSnakeData = { x: ++m_iSnakeHead.x, y: m_iSnakeHead.y };

		    if (m_iDirection == "left") 
		        var tempSnakeData = { x: --m_iSnakeHead.x, y: m_iSnakeHead.y };

		    if (m_iDirection == "down") 
		        var tempSnakeData = { x: m_iSnakeHead.x, y: ++m_iSnakeHead.y };

		    if (m_iDirection == "up") 
		        var tempSnakeData = { x: m_iSnakeHead.x, y: --m_iSnakeHead.y };

		    m_iSnakeBody.unshift(tempSnakeData);
		}

		// Checks if the snake hit the wall or itself.
		function checkCollision() {

            // Checks if snake hit the borders
		    if (m_iSnakeHead.x >= m_iMapWidth)
		        return true;

		    if (m_iSnakeHead.x < 0)
		        return true;

		    if (m_iSnakeHead.y >= m_iMapHeight)
		        return true;

		    if (m_iSnakeHead.y <= 0)
		        return true;

		        // Checks if the snakes hit themselves
		        for (var index = 1; index < m_iSnakeBody.length; index++)
		            if (m_iSnakeHead.x == m_iSnakeBody[index].x && m_iSnakeHead.y == m_iSnakeBody[index].y)
		                return true;

		    return false;
		}

		// Chooses the next position for the food.
		function setFood()
		{
			var bIsFoodOnSnake = true;

			while (bIsFoodOnSnake)
			{
				m_iFoodX = getRandomNumber(0, m_iMapWidth-1);
				m_iFoodY = getRandomNumber(1, m_iMapHeight-1);

				for (var index = 0; index < m_iSnakeBody.length; index++)
				    if (m_iFoodX == m_iSnakeBody[index].x && m_iFoodY == m_iSnakeBody[index].y)
				        continue;

				bIsFoodOnSnake = false;
			}
		}

		// Checks if the snake got the food, so make it longer.
		function gotFood() {
		    
		    if (m_iSnakeHead.x == m_iFoodX && m_iSnakeHead.y == m_iFoodY)
		        return true;

            return false;
		}

		// Handles the changing direction of the snake.
		function doKeyDown(event) {
		    switch (event.keyCode) {

		        // Snake 1
		        case 38:  /* Up arrow was pressed */
		        {
		            if (m_iDirection != "down")
		                m_iDirection = "up";

		            break;
		        }

		        case 40:  /* Down arrow was pressed */
		        {
		            if (m_iDirection != "up")
		                m_iDirection = "down";

		            break;
		        }

		        case 37:  /* Left arrow was pressed */
		        {
		            if (m_iDirection != "right")
		                m_iDirection = "left";

		            break;
		        }

		        case 39:  /* Right arrow was pressed */
		        {
		            if (m_iDirection != "left")
		                m_iDirection = "right";

		            break;
		        }

		        default: /* A key besides arrow key was pressed, pause game */
		            alert("Game Paused");
		    }
		}

		// Sets the canvas as big as the broswer size.
		function setCanvasSize()
		{
		    m_iTileWidth = (Math.floor((window.innerWidth / m_iMapWidth)));//-1;
			m_iTileHeight = (Math.floor((window.innerHeight / m_iMapHeight)));//-1;
			m_CanvasContext.canvas.width = (m_iTileWidth * m_iMapWidth);
			m_CanvasContext.canvas.height = (m_iTileHeight * m_iMapHeight);
		}

		// Resets all variabls so that the game can function properly.
		function resetGame()
		{
		    m_iGameSpeed = m_iOriginalSpeed;

            // Snake 
		    m_iSnakeHead.x = m_iSnakeStartingLength - 2;
			m_iSnakeHead.y = 1;
			m_iSnakeBody = new Array(m_iSnakeStartingLength);
			m_iDirection = "right";
			m_iPrevAmount = m_iAmountAte;

			if (m_iPrevAmount > m_iHighestAmount)
			    m_iHighestAmount = m_iPrevAmount;

			m_iAmountAte = 0;

			// Food Related
			m_iFoodX = 0;
			m_iFoodY = 0;
		}

		// Paints a tile on the screen, handles converting pixel to tile.
		function paintTile(x, y, color, borderThickness) {
		    m_CanvasContext.fillStyle = color;
		    m_CanvasContext.fillRect((x * m_iTileWidth) + borderThickness, (y * m_iTileHeight) + borderThickness, m_iTileWidth - (borderThickness * 2), m_iTileHeight - (borderThickness * 2));
		}

		/*********************************************************************************************************/
		                                        /*USEFULL FUNCTIONS*/

		function writeMessage(startTile,message)
		{
			m_CanvasContext.font = '16pt Calibri';
			m_CanvasContext.fillStyle = 'blue';
			m_CanvasContext.fillText(message, startTile*m_iTileWidth, 20);
		}
		
		function getRandomColor(iMin, iMax) {

			//return m_cColors[getRandomNumber(0, m_cColors.length)];
			// creating a random number between iMin and iMax
			var r = getRandomNumber(iMin, iMax)
			var g = getRandomNumber(iMin, iMax)
			var b = getRandomNumber(iMin, iMax)

			// going from decimal to hex
			var hexR = r.toString(16);
			var hexG = g.toString(16);
			var hexB = b.toString(16);

			// making sure single character values are prepended with a "0"
			if (hexR.length == 1)
				hexR = "0" + hexR;

			if (hexG.length == 1)
				hexG = "0" + hexG;

			if (hexB.length == 1)
				hexB = "0" + hexB;

			// creating the hex value by concatenatening the string values
			var hexColor = "#" + hexR + hexG + hexB;
			return hexColor.toUpperCase();
		}

		function getRandomNumber(iMin, iMax)
		{
			return Math.floor((Math.random() * (iMax - iMin)) + iMin);
		}
	</script>
</head>
<body>
    <canvas id="myCanvas">
</canvas>
</body>
</html>